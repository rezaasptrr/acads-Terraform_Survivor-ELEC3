# üë®‚Äçüíª Developer Guide - Terraform Survivor

Quick guide for developers who want to understand, modify, or extend the game.

## Quick Start

```bash
# Clone the repo
git clone <your-repo-url>
cd terraform-survivor

# Start local server
python -m http.server 8000

# Open in browser
# http://localhost:8000/src/frontend/
```

## Project Structure

### Frontend (`src/frontend/`)

- **index.html** - Main game page (requires config.js)
- **standalone.html** - Self-contained version with default config
- **config.js** - Generated by Terraform (or use default)
- **css/style.css** - All styles in one file
- **js/** - Game logic

### Infrastructure (`src/infrastructure/terraform/`)

- **main.tf** - Terraform configuration
- **variables.tf** - Input variables
- **outputs.tf** - Output values
- **config.js.tpl** - Template for config.js
- **environments/** - Difficulty presets

## Core Concepts

### 1. Component System

All UI elements extend the base `Component` class:

```javascript
import Component from "./Component.js";

class MyComponent extends Component {
  constructor(containerId) {
    super(containerId);
    this.state = {
      /* initial state */
    };
  }

  render() {
    if (!this.container) return;
    this.container.innerHTML = `/* your HTML */`;
  }
}
```

**Key Methods:**

- `mount()` - Attach to DOM and render
- `setState(newState)` - Update state and re-render
- `render()` - Generate HTML

### 2. Game Loop

The main game loop runs every second:

```javascript
startGameLoop() {
    this.gameLoop = setInterval(() => {
        // Decay stats
        this.player.hunger -= hungerDecayRate / 10;
        this.player.thirst -= thirstDecayRate / 10;
        this.player.energy -= energyDecayRate / 10;

        // Check for damage
        if (hunger <= 0 || thirst <= 0) {
            this.player.health -= 1;
        }

        // Update UI
        this.updateAllComponents();

        // Check game over
        this.checkGameOver();
    }, 1000);
}
```

### 3. State Management

Game state is stored in the `Game` class:

```javascript
this.player = {
  health: 100,
  hunger: 100,
  thirst: 100,
  energy: 100,
  day: 1,
};

this.inventory = {
  wood: 5,
  stone: 3,
  berries: 10,
};
```

### 4. Save System

Uses localStorage for persistence:

```javascript
// Save
const state = {
  player: this.player,
  inventory: this.inventory,
  config: this.config,
};
localStorage.setItem("terraformSurvivorSave", JSON.stringify(state));

// Load
const saved = localStorage.getItem("terraformSurvivorSave");
const state = JSON.parse(saved);
```

### 5. Statistics Tracking

Tracks player actions and achievements:

```javascript
// Record action
this.statsTracker.recordAction("explore");

// Record resource
this.statsTracker.recordResource("wood", 5);

// Check achievement
const achievement = this.statsTracker.checkAchievement("survivor", days);
if (achievement) {
  this.notifications.showAchievement(achievement);
}
```

## Adding New Features

### Add a New Action

1. **Add to ActionPanel.js:**

```javascript
{
    id: 'myaction',
    label: 'My Action',
    icon: 'üéØ',
    cost: 10,
    description: 'Does something cool'
}
```

2. **Add handler in Game.js:**

```javascript
handleAction(actionId) {
    const actions = {
        // ... existing actions
        myaction: () => this.doMyAction()
    };
}

doMyAction() {
    if (!this.hasEnergy(10)) return;

    this.player.energy -= 10;
    // Do your action logic
    this.storyLog.addMessage('You did something cool!', 'success');
    this.updateAllComponents();
}
```

3. **Add keyboard shortcut (optional):**

```javascript
const shortcuts = {
  // ... existing shortcuts
  m: () => this.doMyAction(),
};
```

### Add a New Component

1. **Create component file:**

```javascript
// src/frontend/js/components/MyComponent.js
import Component from "./Component.js";

class MyComponent extends Component {
  constructor(containerId) {
    super(containerId);
    this.state = { data: [] };
  }

  setData(data) {
    this.setState({ data });
  }

  render() {
    if (!this.container) return;

    const html = this.state.data.map((item) => `<div>${item}</div>`).join("");

    this.container.innerHTML = `
            <div class="my-component">
                <h3>My Component</h3>
                ${html}
            </div>
        `;
  }
}

export default MyComponent;
```

2. **Add to HTML:**

```html
<div id="myComponent" class="panel"></div>
```

3. **Initialize in Game.js:**

```javascript
import MyComponent from './components/MyComponent.js';

initComponents() {
    // ... existing components
    this.myComponent = new MyComponent('myComponent');
    this.myComponent.mount();
}
```

### Add a New Achievement

1. **Add to StatsTracker.js:**

```javascript
checkActionAchievements() {
    const actionAchievements = [
        // ... existing achievements
        {
            id: 'myach_100',
            name: 'My Achievement',
            desc: 'Do something 100 times',
            check: () => this.stats.myActionCount >= 100
        }
    ];
}
```

2. **Add to Game.js achievement list:**

```javascript
getAllAchievements() {
    return [
        // ... existing achievements
        {
            id: 'myach_100',
            name: 'My Achievement',
            desc: 'Do something 100 times',
            icon: 'üéØ'
        }
    ];
}
```

### Add a New Setting

1. **Add to SettingsPanel.js:**

```javascript
render() {
    const settings = [
        // ... existing settings
        {
            id: 'mySetting',
            label: 'My Setting',
            min: 1,
            max: 10,
            step: 0.5,
            value: this.state.settings.mySetting || 5
        }
    ];
}
```

2. **Use in Game.js:**

```javascript
doSomething() {
    const value = this.config.gameSettings.mySetting;
    // Use the setting
}
```

## Styling

All styles are in `src/frontend/css/style.css`.

### CSS Variables

```css
:root {
  --primary-bg: #1a1d29;
  --secondary-bg: #252936;
  --accent-blue: #4a9eff;
  --accent-purple: #9d4edd;
  --accent-green: #06d6a0;
  /* ... more variables */
}
```

### Component Styling Pattern

```css
.my-component {
  background: var(--panel-bg);
  border: 1px solid var(--panel-border);
  border-radius: var(--border-radius);
  padding: 1rem;
}

.my-component-item {
  padding: 0.5rem;
  transition: var(--transition);
}

.my-component-item:hover {
  background: rgba(255, 255, 255, 0.05);
}
```

## Terraform Integration

### Config Template (`config.js.tpl`)

```javascript
window.GAME_CONFIG = {
  environment: "${environment}",
  difficulty: "${difficulty}",
  gameSettings: {
    hungerDecayRate: ${hunger_decay_rate},
    // ... more settings
  }
};
```

### Generate Config

```bash
cd src/infrastructure/terraform
terraform apply -var-file="environments/dev.tfvars"
```

This generates `src/frontend/config.js` with your settings.

## Testing

### Manual Testing

1. Open `test-features.html`
2. Run all test suites
3. Open game and verify features

### Browser Console

```javascript
// Access game instance
window.game;

// Check player state
window.game.player;

// Check inventory
window.game.inventory;

// Trigger action
window.game.explore();

// View stats
window.game.statsTracker.getStats();
```

## Debugging Tips

### Enable Verbose Logging

```javascript
// In Game.js constructor
this.debug = true;

// In methods
if (this.debug) {
  console.log("Action:", action, "Player:", this.player);
}
```

### Check LocalStorage

```javascript
// View save
JSON.parse(localStorage.getItem("terraformSurvivorSave"));

// View stats
JSON.parse(localStorage.getItem("terraformSurvivorStats"));

// Clear all
localStorage.clear();
```

### Common Issues

**Components not rendering?**

- Check if container ID exists in HTML
- Verify component is mounted in `initComponents()`
- Check browser console for errors

**Save not working?**

- Verify localStorage is enabled
- Check browser privacy settings
- Try incognito mode (some browsers block localStorage)

**Terraform config not loading?**

- Ensure config.js exists
- Check file is loaded before main.js
- Verify Terraform apply succeeded

## Performance Tips

1. **Minimize re-renders**: Only call `setState()` when data changes
2. **Batch updates**: Update multiple components together
3. **Use CSS animations**: Smoother than JavaScript
4. **Debounce frequent events**: Like auto-save
5. **Lazy load**: Only render visible components

## Best Practices

### Code Style

- Use ES6+ features (const, let, arrow functions)
- Keep functions small and focused
- Comment complex logic
- Use meaningful variable names

### Component Design

- Single responsibility principle
- Props down, events up
- Stateless when possible
- Reusable and composable

### State Management

- Keep state minimal
- Derive computed values
- Immutable updates
- Clear ownership

## Deployment

### GitHub Pages

```bash
git add .
git commit -m "Update game"
git push origin main
```

### Vercel

```bash
cd src/infrastructure/terraform
terraform apply -var="vercel_api_token=YOUR_TOKEN"
```

### Custom Server

```bash
# Copy frontend files to server
scp -r src/frontend/* user@server:/var/www/game/
```

## Resources

- [MDN Web Docs](https://developer.mozilla.org/) - JavaScript reference
- [Terraform Docs](https://www.terraform.io/docs) - Terraform guide
- [WCAG Guidelines](https://www.w3.org/WAI/WCAG21/quickref/) - Accessibility
- [Game Dev Patterns](https://gameprogrammingpatterns.com/) - Design patterns

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Test thoroughly
5. Submit a pull request

## License

This project is open source. Feel free to use, modify, and distribute!

---

**Happy coding! üöÄ**
